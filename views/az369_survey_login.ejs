<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>AZ369 보증보험 대체의향서</title>
	<link rel="stylesheet" href="/css/az369_survey_login.css">

	<!--modal css
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">-->

	<!--자바스크립트-->
	<script src="/js/jquery-3.3.1.min.js"></script>
	<script src="/js/scrolla.jquery.min.js"></script>

	<!--폰트-->
	<link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR|PT+Serif&display=swap" rel="stylesheet">

</head>

<body>

	<div class="wrap">

		<h1>임대보증금 보증보험 대체 의향서</h1>

		<div class="sub_wrap">

			<!--폼 전체-->
			<div class="survey_form">
				<h3><span>로그인</span> 후 <br>
					의향서 작성 및 수정, <br>
					결과조회가 가능합니다.</h3>
				<div class="bar"></div>

				<!--폼 리스트-->
				<form name="personal_info">

					<h4>휴대전화번호 ('-' 생략)</h4>
					<input type="number" id="phone" name="phone">

					<h4>비밀번호</h4>
					<input type="password" id="pw" name="pw">
					
					<p>비밀번호를 잊으셨나요? <a href="" class="find_btn">비밀번호 재설정</a></p>
					
					

					<a onclick="next()" class="login">로그인</a>
				</form>
			</div>
		</div>
	</div>


    <!--input maxlength-->
    <script>

        var mySession = JSON.parse(sessionStorage.getItem("mySession"));
        console.log(mySession);
        if(mySession != undefined){
            location.href="/c4"
        }

        $(document).ready(()=>{
            //본인인증
            $("button.check_btn").click((e) => {
                e.preventDefault();
                sendSmsButton();
                return false;
            });

            $("#phone_check").keyup( checkPhoneNumber );

        });

        function numberMaxLength(e) {
            if (e.value.length > e.maxLength) {
                e.value = e.value.slice(0, e.maxLength);
            }
        }

        function sendSmsButton(){
            let phone_number = $("#phone").val();
            phone_number = phone_number.replace(/-/g, "");

            $.ajax({
                dataType: "json",
                url : "/api/auth/phone",
                method : "post",
                data : {
                    phone_number : phone_number
                }
            }).done((res) => {
                $("#alert_msg_success").removeClass('active');
                $("#alert_msg").addClass('active');
            })
        }

        function checkPhoneNumber(e){
            let ele_phone_check = $("#phone_check");
            // let auth_number = ele_phone_check.val();
            let auth_number = e.target.value;

            let phone_number = $("#phone").val();
            phone_number.replace(/-/g, "");

            if( auth_number.length >= 4){

                $.ajax({
                    dataType: "json",
                    url : "/api/auth/phone",
                    method : "get",
                    data : {
                        phone_number : phone_number,
                        auth_number : auth_number
                    }
                }).done((res) => {
                    console.log("checkPhoneNumber !! ");
                    console.log(res);
                    if( res.status_code == 200 ){
                        ele_phone_check.data("is_confirm", true);

                        $("#alert_msg").removeClass('active');
                        $("#alert_msg_fail").removeClass('active');
                        $("#alert_msg_success").addClass('active');
                    } else if ( res.status_code == 400 ){
                        ele_phone_check.data("is_confirm", false);
                        $("#alert_msg").removeClass('active');
                        $("#alert_msg_success").removeClass('active');

                        let ele_alert_fail = $("#alert_msg_fail");
                        ele_alert_fail.text(res.msg);
                        ele_alert_fail.addClass('active');
                    }
                });
            }

        }

        function next(){
            $.ajax({
                url:'/c2/action',
                method: 'post',
                dataType: 'json',
                data:{
                    'phone' : $('#phone').val(),
                    'password' : $('#pw').val()
                },
                success: function(res){
                    console.log(res.data)
                    console.log(res.data[0].Name)
                    var mySession = [{name:"name", value:res.data[0].Name}, {name:"store", value:res.data[0].StoreNumber}, {name:'phone', value:res.data[0].Phone}];
                    sessionStorage.setItem("mySession",JSON.stringify(mySession));
                    location.href = '/c4'
                    
                }
            })

        }

        // function next(){
        //     let survey_result = {};
        //     let phone_check = $("#phone_check").data("is_confirm") || false;
        //     if(!phone_check) {
        //         alert('휴대전화번호 본인인증이 필요합니다.');
        //         return false;
        //     }
        //     survey_result.addr = $("#addr").val();
        //     survey_result.name = $("#name").val();
        //     survey_result.phone = $("#phone").val();
        //     survey_result.cur_has_contract = $("[name=cur_has_contract]:checked").val();

        //     sessionStorage.setItem("survey_result", JSON.stringify(survey_result));

        //     location.href +='?ctrt='+$("[name=cur_has_contract]:checked").val();
        // }
    </script>

    <!--인증번호받기 js-->
    <script>
        function myFunction(e) {
            e.preventDefault();
            document.getElementById("phone_check_box").style.display = "block";
        }
    </script>


</body>

</html>
