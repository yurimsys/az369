<!doctype html>
<html lang="en">
<head>
	<% include templates/admin_head.ejs %>
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">
</head>
<body id="top">

<!-- Preloader -->
<!-- <div id="preloader">
	<div id="status">
		<div class="loader"></div>
	</div>
</div> -->
<!-- /Preloader -->

<div id="body-wrapper" class="body-container">

	<!-- Header begins -->
	<header class="main-nav clearfix">
		<% include templates/admin_header.ejs %>
	</header>
	<!-- /Header ends -->

	<!-- 네비게이션!@!@-->
	<aside class="menu">
		<div class="left-aside-container">			
			<% include templates/admin_sidebar.ejs %>
			<!-- /User profile -->
			<!-- Main menu -->
			<div class="menu-container">
				
			</div>
			<!-- /Main menu -->
		</div>
	</aside>
	<!-- /Sidebar -->

	<!-- Page container begins -->
	<section class="main-container">
		<h1 style="display:none">Empty Heading</h1>
	
			<!--Page Header-->
			<div class="header">
				<div class="header-content">
					<div class="page-title">
						<i class="icon-table2 position-left"></i> 운송사 관리
						<table>
							<tbody style="padding: 0;">
								<tr>
									<td>검색어</td>
									<td>
										<select>
											<option>운송사 이름</option>
											<option>전화번호</option>
											<option>브랜드</option>
										</select>
										<input type="text">
									</td>
								</tr>
								<tr>
									<td>구분</td>
									<td>
										<input type="radio" name="mem">관리자
										<input type="radio" name="mem">회원
									</td>
								</tr>
								<tr>
									<td>가입일</td>
									<td><input type="text"> ~ <input type="text"></td>
								</tr>
							</tbody>
							<tbody id="detailList" style="display: none;">
								<tr>
									<td>항목</td>
									<td>		
										<input type="radio" name="now">항목
										<input type="radio" name="now">항목
									</td>
								</tr>
								<tr>
									<td>테스트</td>
									<td>		
										<input type="text">값
										<input type="text">값
									</td>
								</tr>
			
							</tbody>
						</table>
						<button type="button">검색</button>
						<a id="detailGo" onclick="detailGo()" style="display: block;">상세보기 펼침</a>
						<a id="detailExit" onclick="detailExit()" style="display: none;">상세보기 닫기</a>
					</div>
				</div>
			</div>
			<!--/Page Header-->

			<div class="container-fluid page-content">

				<!-- Individual column searching (text fields) -->
				<div class="card card-inverse card-flat table-responsive">
					<div class="card-header">
						<div class="card-title">Individual column searching <span class="text-semibold">(Text fields)</span></div>
					</div>
					<div class="card-block p-b-0">
						<p>Individual columns searching with <code>text inputs</code>. It can be used by adding <code>column().search()</code> method to the datatable.</p>
					</div>
					<div class="table-responsive">
						<table id="tList">
							<thead>
								<tr>
									<th>B_ID</th>
									<th>B_Name</th>
									<th>B_Tel</th>
									<th>B_Fax</th>
									<th>B_Email</th>
									<th>B_Zip</th>
									<th>B_Addr1</th>
									<th>B_Addr2</th>
									<th>B_cDt</th>
									<th>B_uDt</th>
									<th>Modify</th>
									<th>Delete</th>
								</tr>
							</thead>
						</table>

						<div class="pagination"></div>
					</div>
				</div>
				<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal_primary_header">운송사 추가</button>
				<!-- 수정 모달 -->
				<div id="modal_info_header" class="modal fade" style="display: none;" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header bg-info">
								<button type="button" class="close" data-dismiss="modal">×</button>
								<div class="modal-title">운송사 수정</div>
							</div>

							<div class="modal-body" id="moList">
								
							</div>

							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
								<button type="button" class="btn btn-info" id="update">Modify</button>
							</div>
						</div>
					</div>
				</div>

				<!-- 삭제 모달 -->
				<div id="modal_danger_header" class="modal fade" style="display: none;" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header bg-danger">
								<button type="button" class="close" data-dismiss="modal">×</button>
								<div class="modal-title">운송사 삭제</div>
							</div>

							<div class="modal-body">
								<p>삭제?</p>
							</div>

							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
								<button type="button" class="btn btn-danger" id="delete">Delete</button>
							</div>
						</div>
					</div>
				</div>

				<!-- 행 추가 -->
				<div id="modal_primary_header" class="modal fade" style="display: none;" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header bg-primary">
								<button type="button" class="close" data-dismiss="modal">×</button>
								<div class="modal-title">배차 등록</div>
							</div>

							<div class="modal-body" id="insertList">
								<label>B_Name</label><input type='text' class='form-control'id='name'>
								<label>B_Tel</label><input type='text' class='form-control' id='tel'>
								<label>B_Fax</label><input type='text' class='form-control' id='fax'>
								<label>B_Email</label><input type='text' class='form-control' id='email'>
								<div class="address_form">
									<input type="text" id="postcode" name="postcode" placeholder="매장 우편번호" style="background: #f8f8f8;">
									<button type="button" onclick="execDaumPostcode()" value="우편번호 찾기" class="btn-primary round">우편번호찾기</button><br>
									<input type="text" id="address" name="address" placeholder="매장주소" style="background: #f8f8f8;"><br>
									<input type="text" id="detailAddress" name="detailAddress" placeholder="매장상세주소">
									<input type="text" id="extraAddress" name="extraAddress" hidden=""> <!-- 기본정보  -->
									<input type="text" id="roadAddress" name="roadAddress" hidden="">
									<input type="text" id="jibunAddress" name="jibunAddress" hidden="">
								</div>
							</div>

							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
								<button type="button" class="btn btn-primary" onclick="insert()">추가</button>
							</div>
						</div>
					</div>
				</div>

			</div>

		</section>
		<!-- /Page Container ends -->
		<!-- ScrolltoTop -->
		<!-- <a id="scrollTop" href="#top"><i class="icon-arrow-up12"></i></a> -->
		<!-- /ScrolltoTop -->
		<% include templates/admin_footer.ejs %>
	</div>
	
  
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.js"></script>


	<script>		

function detailGo(){
		$('#detailList').css('display', 'block');
		$('#detailExit').css('display','block');
		$('#detailGo').css('display','none');

	}

	function detailExit(){
		$('#detailList').css('display', 'none');
		$('#detailExit').css('display','none');
		$('#detailGo').css('display','block');
	}
	$(document).ready(function(){
		
		//테이블 생성
		// $.ajax({
		// 	url: '/admin/business/List',
		// 	method: 'post',
		// 	dataType: 'json',
		// 	success: function(res){
		// 		console.log(res.data)
		// 		for(let i=0; i<res.data.length; i++){
		// 			let html = "<tr><td>"+res.data[i].B_ID+"</td>";
		// 				html += "<td>"+res.data[i].B_Name+"</td>";
		// 				html += "<td>"+res.data[i].B_Tel+"</td>";
		// 				html += "<td>"+res.data[i].B_Fax+"</td>";
		// 				html += "<td>"+res.data[i].B_Email+"</td>";
		// 				html += "<td>"+res.data[i].B_Zip+"</td>";
		// 				html += "<td>"+res.data[i].B_Addr1+"</td>";
		// 				html += "<td>"+res.data[i].B_Addr2+"</td>";
		// 				html += "<td>"+res.data[i].B_cDt+"</td>";
		// 				html += "<td>"+res.data[i].B_uDt+"</td>";
		// 				html += "<td><a id="+res.data[i].B_ID+" class='icon-pencil6' data-toggle='modal' data-target='#modal_info_header' onclick='edit(this)''>Edit</a></td>";
		// 				html += "<td><a id="+res.data[i].B_ID+" class='dropdown-item' data-toggle='modal' data-target='#modal_danger_header' onclick='del(this)''>Delete</a></td></tr>";
		// 			$('#testList').append(html);
		// 		} 
				
		// 	}
		// })
		$('#tList').DataTable({
			serverSide: true,
			// processing: true,
			ajax : '/admin/business/List',
			deferRender: true,
			columnDefs : [
				{
					targets:0,
					className : 'dt-body-center'
				}
			],
			start: 0,
			length: 50,
			pageLength: 10,
			rowId : "B_ID",
			columns : [
				{ "data": "B_ID" },
				{ "data": "B_Name" },
				{ "data": "B_Tel" },
				{ "data": "B_Fax" },
				{ "data": "B_Email" },
				{ "data": "B_Zip" },
				{ "data": "B_Addr1" },
				{ "data": "B_Addr2" },
				{ "data": "B_cDt" },
				{ "data": "B_uDt" }
			],
			// buttons: [ 'copy', 'csv', 'excel' ]
			
		});
	})

	
	//운송사 추가
		function insert(){
			$.ajax({
				url: '/admin/business/insert',
				method: 'post',
				dataType: 'json',
				data: {
					'name':$('#name').val(), 'tel' : $('#tel').val(), 'fax':$('#fax').val(), 'email':$('#email').val(),
					'zip':$('#postcode').val(), 'addr1':$('#address').val() , 'addr2':$('#detailAddress').val()
				},
				success: function(res){
				if(res.data == "추가"){
                location.reload();
                }
				}
			})
		}

		//수정                    		
		function edit(e){
			$('#moList').empty();
			$.ajax({
				url: '/admin/businessModify',
				method: 'post',
				dataType: 'json',
				data: {'bId' : e.id},
				success: function(res){
					console.log(res.data.B_Name)
					let	html = "<label for='name'>B_Name:</label><input type='name' class='form-control' id='name' value="+res.data.B_Name+">";
						html += "<label for='Tel'>B_Tel:</label><input type='Tel' class='form-control' id='tel' value="+res.data.B_Tel+">";
						html += "<label for='Fax'>B_Fax:</label><input type='Fax' class='form-control' id='fax' value="+res.data.B_Fax+">";
						html += "<label for='eMail'>B_eMail:</label><input type='eMail' class='form-control' id='eMail' value="+res.data.B_Email+">";
						html += "<label for='zip'>B_Zip:</label><input type='zip' class='form-control' id='zip' value="+res.data.B_Zip+">";												
						html += "<label for='addr1'>B_Addr1:</label><input type='addr1' class='form-control' id='addr1' value="+res.data.B_Addr1+">";
						html += "<label for='addr2'>B_Addr2:</label><input type='addr2' class='form-control' id='addr2' value="+res.data.B_Addr2+">";
						html += "<input type='bId' class='form-control' id='bId' value="+res.data.B_ID+" style='display: none;'>";
					$('#moList').append(html);	
				}
			})
			$('#modal_info_header').css('display','block');
		}

		$('#update').on('click',function(){
			$.ajax({
				url: "/admin/business/modify",
				method: 'post',
				dataType: 'json',
				data: {
					'bId' : $("#bId").val(), 'bName' : $("#name").val(), 'bTel' : $('#tel').val(),
					'bFax' : $("#fax").val(), 'bEmail' : $("#eMail").val(), 'bZip' : $('#zip').val(),
					'bAddr1' : $("#addr1").val(), 'bAddr2' : $("#bAddr2").val()
					},
					success: function(res){
					if(res.data == "수정"){
						//alert("수정완료");
						location.reload();
					}
				}
			})
		})


		//삭제
		function del(e){
			$('#delete').attr('val', e.id);
			$('#delete').on('click',function(){
				$.ajax({
					url: '/admin/businessDelete',
					method: 'post',
					dataType: 'json',
					data: {'bId' : e.id},
					success: function(res){
						//alert("삭제");
						location.reload()
					}
				})
			})
		}
	</script>
</body>
</html>
